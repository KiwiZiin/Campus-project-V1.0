<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Campus MarketPlace — Produtos (Final Dinâmico)</title>

<!-- Fonte + GSAP -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

<style>
  :root{
    --bg:#07080a;
    --panel:#0f1113;
    --muted:#bfc6d6;
    --white:#ffffff;
    --accent:#0077ff;
    --accent-2:#00ffaa;
    --radius:12px;
    --gap:16px;
    --touch-min:44px;
    font-family:"Poppins",sans-serif;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{background:linear-gradient(180deg,#060708,#0b0c0f 60%);color:var(--muted);-webkit-font-smoothing:antialiased;overflow-x:hidden}
  a{color:inherit;text-decoration:none}
  .container{max-width:1200px;margin:0 auto;padding:0 16px}

  /* HEADER */
  header{position:sticky;top:0;z-index:120;background:rgba(6,8,10,0.6);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,0.03)}
  .header-inner{height:64px;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:0 16px}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{height:36px;border-radius:6px}
  nav{display:flex;gap:8px;align-items:center}
  .btn{padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer;border:0;transition:all .18s ease;font-size:14px;min-height:var(--touch-min)}
  .btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)}
  .btn.primary{background:var(--accent);color:var(--white)}
  .btn.outline{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--muted)}

  /* HERO */
  section{padding:42px 0}
  .hero{padding:72px 0 28px}
  .hero-inner{display:flex;gap:18px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .hero-left{flex:1;min-width:220px}
  .hero-title{font-size:34px;color:var(--white);line-height:1;font-weight:800;margin-bottom:10px}
  .hero-title .accent{color:var(--accent)}
  .lead{color:rgba(255,255,255,0.86);max-width:680px;margin-bottom:12px;font-size:15px}
  .hero-ctas{display:flex;gap:10px;flex-wrap:wrap}

  .hero-right{flex:1;min-width:240px;display:flex;justify-content:center}
  .hero-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.12));padding:14px;border-radius:12px;width:100%;max-width:520px;box-shadow:0 6px 18px rgba(0,0,0,0.45)}
  .hero-card img{width:100%;border-radius:10px;display:block}

  .section-title{font-size:20px;color:var(--white);margin-bottom:12px;text-align:center;font-weight:700}

  /* CARROSSEL */
  .carousel-wrapper{max-width:1200px;margin:0 auto;position:relative;padding-bottom:18px}
  .carousel-track{display:flex;gap:var(--gap);padding:8px 8px;transition:transform .55s cubic-bezier(.22,.9,.28,1);will-change:transform;touch-action:pan-y}
  .card{background:var(--panel);border-radius:10px;overflow:hidden;min-width:220px;flex:0 0 calc(25% - var(--gap));box-shadow:0 6px 18px rgba(0,0,0,0.45);border:1px solid rgba(255,255,255,0.02);cursor:pointer;display:flex;flex-direction:column}
  .card img{width:100%;height:180px;object-fit:cover;display:block}
  .card-content{padding:12px;flex:1;display:flex;flex-direction:column;justify-content:space-between}
  .badge{display:inline-block;background:linear-gradient(90deg,var(--accent),#00b4ff);color:white;padding:6px 9px;border-radius:8px;font-weight:700;font-size:12px;margin-bottom:8px}
  .card h3{color:var(--white);font-size:15px;margin:6px 0}
  .card p{color:var(--muted);font-size:13px;margin-bottom:6px}
  .price{margin-top:8px;color:var(--accent-2);font-weight:800;font-size:16px}

  .carousel-controls{position:absolute;top:50%;left:0;right:0;display:flex;justify-content:space-between;pointer-events:none;padding:0 8px}
  .carousel-btn{pointer-events:all;width:44px;height:44px;border-radius:999px;border:0;background:rgba(255,255,255,0.06);color:var(--white);display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer}
  .carousel-btn:hover{background:var(--accent);box-shadow:0 8px 24px rgba(0,119,255,0.14)}

  /* DOTS */
  .dots-wrap{display:flex;justify-content:center;margin-top:12px;gap:8px}
  .dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.12);cursor:pointer;transition:all .18s ease;box-shadow:0 2px 6px rgba(0,0,0,0.4)}
  .dot.active{width:28px;background:linear-gradient(90deg,var(--accent),#00b4ff);box-shadow:0 8px 20px rgba(0,100,255,0.18)}

  /* CATEGORIES */
  .categories-wrap{max-width:1200px;margin:8px auto 0;padding:0 16px}
  .cat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:8px}
  .cat-card{background:linear-gradient(180deg,#111217,#17181b);padding:12px;border-radius:10px;text-align:left;box-shadow:0 6px 12px rgba(0,0,0,0.45);cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
  .cat-card h3{color:var(--accent);margin-bottom:6px;font-size:15px}
  .cat-card p{color:var(--muted);font-size:13px}

  /* PANELS */
  .grid-3{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
  .panel{background:var(--panel);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);box-shadow:0 6px 18px rgba(0,0,0,0.4)}
  .panel h4{color:var(--white);margin-bottom:8px;font-size:15px}
  .panel p{color:var(--muted);font-size:13px}

  /* PRODUCT DETAIL */
  .product-detail{max-width:1200px;margin:28px auto;padding:12px;opacity:0;transform:translateY(20px)}
  .pd-grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
  .gallery{background:var(--panel);padding:10px;border-radius:10px}
  .main-image{width:100%;height:360px;object-fit:cover;border-radius:8px;display:block;box-shadow:0 10px 30px rgba(0,0,0,0.5)}
  .thumbs{display:flex;gap:8px;margin-top:10px;overflow:auto;padding-bottom:6px}
  .thumbs img{width:72px;height:72px;object-fit:cover;border-radius:8px;border:2px solid transparent;cursor:pointer;flex:0 0 auto}
  .thumbs img.active{border-color:var(--accent)}
  .pd-info{background:var(--panel);padding:12px;border-radius:10px;position:sticky;top:72px;height:fit-content;border:1px solid rgba(255,255,255,0.02)}
  .pd-info h2{color:var(--white);margin-bottom:6px;font-size:18px}
  .pd-info .meta{color:var(--muted);font-size:13px;margin-bottom:8px}
  .pd-info .pd-price{font-size:20px;color:var(--accent-2);font-weight:800;margin-bottom:10px}
  .pd-actions{display:flex;gap:8px;flex-wrap:wrap}
  .buy-btn{background:linear-gradient(90deg,var(--accent),#00a3ff);color:#fff;padding:10px 14px;border-radius:10px;border:0;font-weight:800;cursor:pointer;font-size:15px;min-height:var(--touch-min)}
  .cart-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 12px;border-radius:10px;cursor:pointer;min-height:var(--touch-min)}

  .tabs{margin-top:12px}
  .specs, .desc, .reviews-list{background:var(--panel);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);margin-bottom:10px}
  .specs table{width:100%;color:var(--muted);font-size:13px;border-collapse:collapse}
  .specs tr td{padding:6px 4px;border-bottom:1px dashed rgba(255,255,255,0.03)}
  .review{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px}
  .review strong{color:var(--accent-2)}

  footer{padding:24px 0;text-align:center;color:rgba(255,255,255,0.35);border-top:1px solid rgba(255,255,255,0.02);margin-top:24px}

  /* Responsive */
  @media(max-width:1000px){ .pd-grid{grid-template-columns:1fr 320px} .main-image{height:320px} }
  @media(max-width:820px){
    .card{flex:0 0 calc(50% - var(--gap))}
    .cat-grid{grid-template-columns:repeat(2,1fr)}
    .pd-grid{grid-template-columns:1fr}
    .pd-info{position:static;top:auto}
    .hero-title{font-size:28px}
    nav{display:none}
    .carousel-btn{display:none}
    .lead{font-size:14px}
    .hero{padding-top:56px}
  }
  @media(max-width:480px){
    .card{flex:0 0 90%}
    .main-image{height:240px}
    .hero{padding-top:48px}
    .hero-title{font-size:22px}
    .thumbs img{width:64px;height:64px}
    .pd-info .pd-price{font-size:18px}
    .btn{font-size:14px;padding:10px 12px}
    .dots-wrap{gap:6px}
    .dot{width:10px;height:10px}
    .dot.active{width:22px}
  }

  .muted{color:var(--muted)}
  .small{font-size:13px;color:var(--muted)}
</style>
</head>
<body>

<header>
  <div class="header-inner container">
    <div class="brand">
      <img src="https://picsum.photos/seed/logo/120/40" alt="logo">
      <div class="small muted">Campus MarketPlace</div>
    </div>
    <nav>
      <a href="#carousel" class="btn ghost">Produtos</a>
      <a href="#categories" class="btn ghost">Categorias</a>
      <a href="#about" class="btn ghost">Sobre</a>
      <button class="btn outline">Entrar</button>
      <button class="btn primary">Cadastrar</button>
    </nav>
  </div>
</header>

<main>
  <!-- HERO -->
  <section class="hero">
    <div class="container hero-inner">
      <div class="hero-left">
        <h1 class="hero-title">Campus <span class="accent">MarketPlace</span></h1>
        <p class="lead">Compre e venda dentro do campus. Ofertas rápidas, seguras e com a comunidade que você conhece.</p>
        <div class="hero-ctas">
          <button class="btn primary" id="exploreBtn">Ver Ofertas</button>
          <a href="#product-detail" class="btn outline">Produto em destaque</a>
        </div>
      </div>
      <div class="hero-right">
        <div class="hero-card" aria-hidden>
          <img src="https://picsum.photos/800/520?random=90" alt="banner destaque">
        </div>
      </div>
    </div>
  </section>

  <!-- CARROSSEL -->
  <section id="carousel">
    <div class="container">
      <h2 class="section-title">Anúncios Recentes</h2>
      <div class="carousel-wrapper" aria-live="polite">
        <div class="carousel-track" id="carouselTrack" role="list"></div>
        <div class="carousel-controls" aria-hidden="true">
          <button class="carousel-btn" id="prevBtn" aria-label="Anterior">‹</button>
          <button class="carousel-btn" id="nextBtn" aria-label="Próximo">›</button>
        </div>
      </div>
      <div class="dots-wrap" id="dotsWrap" aria-hidden="false"></div>
    </div>
  </section>

  <!-- CATEGORIES -->
  <section id="categories">
    <div class="container categories-wrap">
      <h2 class="section-title">Categorias Populares</h2>
      <div class="cat-grid" id="catGrid">
        <div class="cat-card"><h3>Eletrônicos</h3><p>Fones, mouses, teclados e acessórios.</p></div>
        <div class="cat-card"><h3>Moda</h3><p>Roupas e acessórios para o dia a dia.</p></div>
        <div class="cat-card"><h3>Casa</h3><p>Itens práticos para seu quarto e cozinha.</p></div>
        <div class="cat-card"><h3>Estudos</h3><p>Livros, apostilas e materiais acadêmicos.</p></div>
      </div>
    </div>
  </section>

  <!-- ABOUT / FEATURES -->
  <section id="about">
    <div class="container">
      <h2 class="section-title">Sobre o Projeto</h2>
      <div class="grid-3">
        <div class="panel"><h4>Objetivo</h4><p>Conectar estudantes de forma segura para comprar e vender dentro do campus.</p></div>
        <div class="panel"><h4>Metodologia</h4><p>Desenvolvido como Projeto Integrador, com foco em UX e velocidade.</p></div>
        <div class="panel"><h4>Impacto</h4><p>Fortalece a economia local e facilita o acesso entre alunos.</p></div>
      </div>

      <h2 class="section-title" style="margin-top:18px">Funcionalidades</h2>
      <div class="grid-3" style="margin-top:10px">
        <div class="panel"><h4>Anúncios</h4><p>Publique com fotos e descrição detalhada.</p></div>
        <div class="panel"><h4>Chat</h4><p>Converse com o vendedor sem sair da plataforma.</p></div>
        <div class="panel"><h4>Pagamento</h4><p>Negocie via Pix ou pagamento presencial.</p></div>
      </div>
    </div>
  </section>

  <!-- PRODUCT DETAIL (nova seção "página" que é preenchida dinamicamente) -->
  <section id="product-detail" class="product-detail">
    <div class="pd-grid container">
      <div>
        <div class="gallery">
          <img id="mainImage" class="main-image" src="https://picsum.photos/1200/900?random=201" alt="Produto destaque">
          <div class="thumbs" id="thumbs" aria-label="Miniaturas"></div>
        </div>

        <div class="tabs" style="margin-top:12px">
          <div class="desc">
            <h4 id="pd-title" style="color:var(--white)">Descrição</h4>
            <p id="pd-desc" class="muted" style="margin-top:8px">Selecione um produto para ver detalhes.</p>
          </div>

          <div class="specs">
            <h4 style="color:var(--white)">Especificações</h4>
            <table id="pd-specs">
              <tr><td>Condição</td><td>—</td></tr>
            </table>
          </div>

          <div class="reviews-list" id="pd-reviews">
            <h4 style="color:var(--white)">Avaliações</h4>
            <div class="review"><strong>—</strong></div>
          </div>
        </div>
      </div>

      <aside class="pd-info" aria-label="Informações do produto">
        <h2 id="pd-name">Produto em destaque</h2>
        <div class="meta small muted">Vendedor <strong id="pd-seller">—</strong></div>
        <div class="pd-price" id="pd-price">R$ —</div>

        <div class="pd-actions">
          <button class="buy-btn" id="pd-buy">Comprar Agora</button>
          <button class="cart-btn" id="pd-add">Adicionar ao carrinho</button>
        </div>

        <div style="margin-top:8px" class="small muted">Pagamento via Pix disponível. Retirada no campus ou entrega local.</div>
      </aside>
    </div>
  </section>

  <footer>
    <div class="container">
      <div style="margin-bottom:6px"><strong>Campus MarketPlace</strong> — Projeto IFSP 2025</div>
      <div class="small muted">Design responsivo, animações GSAP e foco mobile-first.</div>
    </div>
  </footer>
</main>

<script>
/* ======================= DADOS INICIAIS ======================= */
const produtos = [
  { id:1, tag:"OFERTA DO DIA", title:"Trufas Artesanais", seller:"Maria Santos", price:"R$ 5,00", imgLarge:"https://picsum.photos/1200/900?random=1", imgs:[1,11,12], desc:"Trufas deliciosas feitas artesanalmente.", specs:{Condição:"Novo", Marca:"DoceArte", Dimensões:"8x8x3 cm", Peso:"120 g"}, reviews:[{rate:5, text:"Maravilhoso!"},{rate:4, text:"Gostoso e rápido."}]},
  { id:2, tag:"DESTAQUE", title:"Lanche Natural", seller:"João Pereira", price:"R$ 7,50", imgLarge:"https://picsum.photos/1200/900?random=2", imgs:[2,21,22], desc:"Lanche saudável com ingredientes frescos.", specs:{Condição:"Novo", Marca:"VidaSaudavel", Dimensões:"15x8x6 cm", Peso:"250 g"}, reviews:[{rate:5, text:"Super prático."}]},
  { id:3, tag:"PROMOÇÃO", title:"Doces Caseiros", seller:"João Pedro", price:"R$ 4,00", imgLarge:"https://picsum.photos/1200/900?random=3", imgs:[3,31,32], desc:"Doces caseiros preparados com carinho.", specs:{Condição:"Usado - Bom", Marca:"CasaDoces", Dimensões:"10x7x3 cm", Peso:"90 g"}, reviews:[{rate:5, text:"Muito bom."}]},
  { id:4, tag:"NOVIDADE", title:"Gelatos e Sorvetes", seller:"Rafaela Costa", price:"R$ 6,00", imgLarge:"https://picsum.photos/1200/900?random=4", imgs:[4,41,42], desc:"Gelatos artesanais, cremosos.", specs:{Condição:"Novo", Marca:"GelatoLab", Dimensões:"N/A", Peso:"200 g"}, reviews:[{rate:5, text:"Gelato top."}]},
  { id:5, tag:"SABOROSO", title:"Palha Italiana", seller:"XOPO", price:"R$ 3,50", imgLarge:"https://picsum.photos/1200/900?random=5", imgs:[5,51,52], desc:"Palha italiana crocante.", specs:{Condição:"Novo", Marca:"DoceFesta", Dimensões:"N/A", Peso:"80 g"}, reviews:[{rate:4, text:"Bom custo-benefício."}]},
  { id:6, tag:"OFERTA", title:"Canecas Personalizadas", seller:"Carlos Souza", price:"R$ 15,00", imgLarge:"https://picsum.photos/1200/900?random=6", imgs:[6,61,62], desc:"Canecas com estampas únicas.", specs:{Condição:"Novo", Marca:"Ceramix", Dimensões:"10x8x8 cm", Peso:"330 g"}, reviews:[{rate:5, text:"Amei a estampa!"}]},
  { id:7, tag:"LANÇAMENTO", title:"Brownie Especial", seller:"Pedro Lima", price:"R$ 6,50", imgLarge:"https://picsum.photos/1200/900?random=7", imgs:[7,71,72], desc:"Brownie fofinho e gostoso.", specs:{Condição:"Novo", Marca:"BrownieHouse", Dimensões:"N/A", Peso:"150 g"}, reviews:[{rate:5, text:"Delícia."}]},
  { id:8, tag:"DESTAQUE", title:"Café Gelado", seller:"Luiza Rocha", price:"R$ 8,00", imgLarge:"https://picsum.photos/1200/900?random=8", imgs:[8,81,82], desc:"Café gelado com toque especial.", specs:{Condição:"Novo", Marca:"CaféX", Dimensões:"N/A", Peso:"350 g"}, reviews:[{rate:4, text:"Refrescante."}]},
  { id:9, tag:"LIMITADO", title:"Caneca Edição", seller:"Ana Clara", price:"R$ 20,00", imgLarge:"https://picsum.photos/1200/900?random=9", imgs:[9,91,92], desc:"Edição limitada da caneca.", specs:{Condição:"Novo", Marca:"Ceramix", Dimensões:"10x8x8 cm", Peso:"330 g"}, reviews:[{rate:5, text:"Peça exclusiva."}]},
  { id:10, tag:"PROMOÇÃO", title:"Sanduíche Fit", seller:"Felipe", price:"R$ 9,50", imgLarge:"https://picsum.photos/1200/900?random=10", imgs:[10,101,102], desc:"Sanduíche proteico e saudável.", specs:{Condição:"Novo", Marca:"FitSnack", Dimensões:"N/A", Peso:"220 g"}, reviews:[{rate:5, text:"Perfeito para o almoço."}]}
];

const track = document.getElementById('carouselTrack');
const thumbs = document.getElementById('thumbs');
const dotsWrap = document.getElementById('dotsWrap');

/* ========== POPULAÇÃO DO CARROSSEL (cards) ========== */
function mountCards(){
  track.innerHTML = '';
  produtos.forEach((p)=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('data-id', p.id);
    card.innerHTML = `
      <img src="${p.imgLarge}" alt="${p.title}">
      <div class="card-content">
        <div>
          <div class="badge">${p.tag}</div>
          <h3>${p.title}</h3>
          <p class="small muted">Por ${p.seller}</p>
        </div>
        <div class="price">${p.price}</div>
      </div>
    `;
    card.addEventListener('click', ()=> openProduct(p.id));
    track.appendChild(card);
  });
}
mountCards();

/* ================= GSAP: entradas e scroll effects ================ */
gsap.registerPlugin(ScrollTrigger);
const mm = gsap.matchMedia();

// desktop animations
mm.add("(min-width:821px)", () => {
  gsap.from(".header-inner",{y:-20,opacity:0,duration:.8,ease:"power2.out"});
  gsap.from(".hero-title",{y:40,opacity:0,duration:1,ease:"power3.out",stagger:.06});
  gsap.from(".lead",{y:18,opacity:0,duration:.9,delay:.15});
  gsap.utils.toArray('.card').forEach((c,i)=>{
    gsap.fromTo(c,{opacity:0,y:30},{opacity:1,y:0,duration:.7,delay:i*0.04,ease:"power3.out",scrollTrigger:{trigger:c,start:"top 92%"}});
  });
  gsap.from('.cat-card',{y:20,opacity:0,duration:.7,stagger:.12,scrollTrigger:{trigger:'.cat-grid',start:'top 85%'}});
  gsap.from('.panel',{y:20,opacity:0,duration:.7,stagger:.12,scrollTrigger:{trigger:'#about',start:'top 85%'}});
  // parallax hero right image
  gsap.to('.hero-card img', { y: -20, ease: 'none', scrollTrigger:{trigger: '.hero', start: 'top top', end: 'bottom top', scrub: 0.8} });
  // subtle reveal for product-detail when scrolled into view
  gsap.from('.product-detail', { autoAlpha: 0, y: 20, duration: 0.7, scrollTrigger: { trigger: '.product-detail', start: 'top 90%' } });
});

// mobile lighter animations
mm.add("(max-width:820px)", () => {
  gsap.from(".header-inner",{y:-10,opacity:0,duration:.45});
  gsap.from(".hero-title",{y:20,opacity:0,duration:.6});
  gsap.from(".lead",{opacity:0,duration:.5,delay:.08});
  gsap.utils.toArray('.card').forEach((c,i)=>{
    gsap.fromTo(c,{opacity:0,y:12},{opacity:1,y:0,duration:.45,delay:i*0.03,ease:"power2.out"});
  });
  gsap.from('.cat-card',{opacity:0,y:12,duration:.45,stagger:.06});
  gsap.from('.panel',{opacity:0,y:12,duration:.45,stagger:.06});
});

/* ================= CARROSSEL: perView, flex-basis, nav, dots, swipe ============== */
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');

let index = 0;
let perView = getPerView();
let autoSlide = null;

function getPerView(){
  const w = window.innerWidth;
  if (w <= 480) return 1;
  if (w <= 820) return 2;
  if (w <= 1000) return 3;
  return 4;
}

function applyPerView(){
  perView = getPerView();
  const cards = document.querySelectorAll('.card');
  const percent = (100 / perView);
  cards.forEach(c=>{
    c.style.flex = `0 0 calc(${percent}% - ${ (perView>1 ? 'var(--gap)' : '0px') })`;
  });
  buildDots();
  index = 0;
  gsap.to(track, { x: 0, duration: 0.28 });
}
applyPerView();
window.addEventListener('resize', ()=> { applyPerView(); updateCarousel(); });

function pagesCount(){
  return Math.max(1, Math.ceil(track.children.length / perView));
}
function maxIndex(){
  return pagesCount() - 1;
}

// NAV
nextBtn.addEventListener('click', ()=> {
  index = (index + 1) > maxIndex() ? 0 : index + 1;
  updateCarousel();
  restartAuto();
});
prevBtn.addEventListener('click', ()=> {
  index = (index - 1) < 0 ? maxIndex() : index - 1;
  updateCarousel();
  restartAuto();
});

// DOTS
function buildDots(){
  const pages = pagesCount();
  dotsWrap.innerHTML = '';
  for(let i=0;i<pages;i++){
    const d = document.createElement('button');
    d.className = 'dot';
    d.setAttribute('aria-label', `Página ${i+1}`);
    d.addEventListener('click', ()=> { index = i; updateCarousel(); restartAuto(); });
    dotsWrap.appendChild(d);
  }
  updateDots();
}
function updateDots(){
  const nodes = dotsWrap.querySelectorAll('.dot');
  nodes.forEach((n,i)=> n.classList.toggle('active', i === index));
  nodes.forEach((n,i)=> gsap.to(n, { scale: i === index ? 1.05 : 1, duration: 0.16, ease:'power2.out' }));
}

// Update transform by pages
function updateCarousel(){
  const pages = pagesCount();
  // shift percent: each page is (100 / pages)
  const shiftPercent = (index * 100) / pages;
  gsap.to(track, { x: `-${shiftPercent}%`, duration: 0.48, ease: "power2.out", onComplete: updateDots });
}

// AUTOPLAY
function startAuto(){ clearInterval(autoSlide); autoSlide = setInterval(()=> { index = (index + 1) > maxIndex() ? 0 : index + 1; updateCarousel(); }, 4500); }
function restartAuto(){ clearInterval(autoSlide); startAuto(); }
startAuto();

// PAUSE on interaction
track.addEventListener('mouseenter', ()=> clearInterval(autoSlide));
track.addEventListener('mouseleave', ()=> startAuto());
track.addEventListener('touchstart', ()=> clearInterval(autoSlide), {passive:true});
track.addEventListener('touchend', ()=> startAuto(), {passive:true});

// SWIPE implementation
let startX=0, currentX=0, dragging=false;
track.addEventListener('touchstart', (e)=> {
  if (!e.touches) return;
  dragging = true; startX = e.touches[0].clientX; currentX = startX;
  gsap.killTweensOf(track);
}, {passive:true});
track.addEventListener('touchmove', (e)=> {
  if (!dragging) return;
  currentX = e.touches[0].clientX;
  const dx = currentX - startX;
  const percent = (dx / window.innerWidth) * 100;
  const pages = pagesCount();
  const basePercent = (index * 100) / pages;
  const temp = basePercent - (percent / pages);
  gsap.set(track, { x: `-${temp}%` });
  if (Math.abs(dx) > 10) e.preventDefault();
}, {passive:false});
track.addEventListener('touchend', ()=> {
  if (!dragging) return;
  dragging = false;
  const dx = currentX - startX;
  const threshold = Math.max(20, window.innerWidth * 0.08);
  if (dx < -threshold) index = Math.min(maxIndex(), index + 1);
  else if (dx > threshold) index = Math.max(0, index - 1);
  updateCarousel();
  startAuto();
}, {passive:true});

/* ================= DYNAMIC PRODUCT DETAIL (Option 2 behavior) ================= */
const pdName = document.getElementById('pd-name');
const pdSeller = document.getElementById('pd-seller');
const pdPrice = document.getElementById('pd-price');
const pdTitle = document.getElementById('pd-title');
const pdDesc = document.getElementById('pd-desc');
const pdSpecs = document.getElementById('pd-specs');
const pdReviews = document.getElementById('pd-reviews');
const pdMainImage = document.getElementById('mainImage');

// when card clicked: openProduct(id) -> populate product-detail and transition to it
function openProduct(id){
  const product = produtos.find(p=>p.id === id);
  if (!product) return;
  // timeline: fade out product-detail slightly, update content, scroll to it, animate in
  const tl = gsap.timeline({ defaults: { duration: 0.28, ease: 'power2.inOut' }});
  tl.to('.product-detail', { autoAlpha: 0, y: 12 })
    .call(()=> populateProductDetail(product))
    .call(()=> {
      // scroll smoothly to product-detail top
      document.querySelector('#product-detail').scrollIntoView({behavior:'smooth', block:'start'});
    })
    .to('.product-detail', { autoAlpha: 1, y: 0, duration: 0.45, ease: 'power3.out' });
  // highlight the active dot corresponding to the card's page
  animateCardClickFeedback(id);
}

// populate product detail area with clicked product
function populateProductDetail(p){
  pdName.textContent = p.title;
  pdSeller.textContent = p.seller;
  pdPrice.textContent = p.price;
  pdTitle.textContent = p.title;
  pdDesc.textContent = p.desc || 'Descrição não disponível.';
  // specs table
  pdSpecs.innerHTML = '';
  for(const [k,v] of Object.entries(p.specs || {})){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td style="width:40%">${k}</td><td>${v}</td>`;
    pdSpecs.appendChild(tr);
  }
  // reviews
  pdReviews.innerHTML = '<h4 style="color:var(--white)">Avaliações</h4>';
  if ((p.reviews||[]).length === 0) {
    pdReviews.innerHTML += '<div class="review small muted">Sem avaliações.</div>';
  } else {
    p.reviews.forEach(r=>{
      const div = document.createElement('div');
      div.className = 'review';
      div.innerHTML = `<strong>${r.rate}.0</strong> — "${r.text}" <div class="small muted">— usuário</div>`;
      pdReviews.appendChild(div);
    });
  }
  // main image and thumbs
  pdMainImage.src = p.imgLarge;
  thumbs.innerHTML = '';
  // create a small set of thumbnail variations using the product imgs array (simulated)
  (p.imgs || [p.id]).forEach((n, i)=>{
    // for demo use different random images derived from original id
    const thumbUrl = `https://picsum.photos/400/400?random=${p.id*10 + i}`;
    const fullUrl = `https://picsum.photos/1200/900?random=${p.id*10 + i}`;
    const img = document.createElement('img');
    img.src = thumbUrl;
    img.dataset.full = fullUrl;
    if(i===0) img.classList.add('active');
    img.alt = `${p.title} - ${i+1}`;
    thumbs.appendChild(img);
  });
  // attach thumb click handlers (for newly created thumbs)
  thumbs.querySelectorAll('img').forEach(img=>{
    img.addEventListener('click', (e)=>{
      const full = img.dataset.full || img.src;
      gsap.to(pdMainImage, { opacity: 0, scale: 0.98, duration: 0.12, onComplete: ()=>{
        pdMainImage.src = full;
        gsap.to(pdMainImage, { opacity: 1, scale: 1, duration: 0.22, ease: 'power2.out' });
      }});
      thumbs.querySelectorAll('img').forEach(i=>i.classList.remove('active'));
      img.classList.add('active');
    });
  });
}

/* small visual feedback for card click */
function animateCardClickFeedback(id){
  const card = track.querySelector(`.card[data-id="${id}"]`);
  if (!card) return;
  const tl = gsap.timeline();
  tl.to(card, { scale: 0.98, duration: 0.08 })
    .to(card, { scale: 1, duration: 0.18, ease: 'elastic.out(1,0.6)' });
}

/* CTA scroll to carousel */
document.getElementById('exploreBtn').addEventListener('click', ()=> {
  document.getElementById('carousel').scrollIntoView({behavior:'smooth'});
});

/* keyboard nav for carousel */
document.addEventListener('keydown', (e)=>{
  if (e.key === 'ArrowRight') nextBtn.click();
  if (e.key === 'ArrowLeft') prevBtn.click();
});

/* Rebuild dots and initial state */
applyPerView();
buildDots();
updateCarousel();

</script>
</body>
</html>
